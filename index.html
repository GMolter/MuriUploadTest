<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Muri Advanced Player Test</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
/* ======== THEME ======== */
:root {
    --bg: #f5f5fb;
    --fg: #111;
    --card: rgba(255,255,255,0.7);
    --primary: #6366f1;
    --primary-hover: #4f46e5;
    --border: rgba(0,0,0,0.1);
}

body.dark {
    --bg: #0b1120;
    --fg: #fff;
    --card: rgba(20,20,30,0.5);
    --border: rgba(255,255,255,0.1);
}

body {
    background: var(--bg);
    color: var(--fg);
    font-family: Inter, sans-serif;
    margin: 0;
    padding: 20px;
    max-width: 700px;
    margin: auto;
}

/* GENERAL */
button {
    padding: 12px;
    border-radius: 10px;
    border: none;
    width: 100%;
    background: var(--primary);
    color: white;
    font-size: 15px;
}
button:hover { background: var(--primary-hover); }

/* CARD */
.card {
    padding: 20px;
    border-radius: 16px;
    background: var(--card);
    border: 1px solid var(--border);
    margin-top: 20px;
    backdrop-filter: blur(10px);
}

/* PLAYER */
.player-container {
    position: relative;
    width: 100%;
    border-radius: 16px;
    overflow: hidden;
    margin-top: 20px;
}

video {
    width: 100%;
    display: block;
}

/* CUSTOM OVERLAY */
.player-overlay {
    position: absolute;
    inset: 0;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    pointer-events: none;
}

.player-center {
    pointer-events: auto;
    display: flex;
    justify-content: center;
    margin-top: 30%;
}

.control-btn {
    width: 60px;
    height: 60px;
    background: rgba(0,0,0,0.4);
    border-radius: 50%;
    border: 1px solid rgba(255,255,255,0.3);
    color: white;
    font-size: 22px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.skip-row {
    display: flex;
    justify-content: space-between;
    padding: 0 40px;
    margin-top: 20px;
}

.small-btn {
    width: 50px;
    height: 50px;
    background: rgba(0,0,0,0.35);
    border-radius: 50%;
    border: 1px solid rgba(255,255,255,0.2);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
}

/* PROGRESS BAR */
.progress-container {
    width: 100%;
    height: 6px;
    background: rgba(255,255,255,0.3);
    position: relative;
    cursor: pointer;
}

.progress-bar {
    height: 100%;
    background: var(--primary);
    width: 0%;
}

/* HIDDEN AUDIO */
audio {
    display: none;
}
</style>
</head>
<body>

<h1>Muri Advanced Player Test</h1>

<!-- Upload Section -->
<div class="card">
    <h2>Upload Video</h2>
    <input type="file" id="fileInput" accept="video/*">
    <button onclick="uploadVideo()">Upload</button>
    <p id="uploadStatus"></p>
</div>

<!-- Video List -->
<div class="card">
    <h2>Videos</h2>
    <div id="videoList"></div>
</div>

<!-- ADVANCED PLAYER -->
<h2>Player</h2>

<div class="player-container">
    <video id="video"></video>
    <audio id="audio"></audio>

    <div class="player-overlay">
        <div></div>
        <div class="player-center">
            <button class="control-btn" id="playPauseBtn">▶</button>
        </div>

        <div class="skip-row">
            <button class="small-btn" onclick="skipBack()">⟲ 10</button>
            <button class="small-btn" onclick="skipForward()">⟳ 10</button>
        </div>

        <div>
            <div class="progress-container" onclick="seek(event)">
                <div class="progress-bar" id="progress"></div>
            </div>
        </div>
    </div>
</div>

<script>
// ======== SUPABASE CONFIG ========
const SUPABASE_URL = "https://azkthlaezuqiuidokqwy.supabase.co";
const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImF6a3RobGFlenVxaXVpZG9rcXd5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ0NzQ1NTMsImV4cCI6MjA4MDA1MDU1M30.-ddzglqIhff6UVujsQbgmpESTrHsXLww7AZ_fcEdLHg";
const db = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

// ======== DOM ELEMENTS ========
const video = document.getElementById("video");
const audio = document.getElementById("audio");
const progress = document.getElementById("progress");
const playPauseBtn = document.getElementById("playPauseBtn");

// ======== LOAD AND PLAY ========
function playVideo(url) {
    video.src = url;
    audio.src = url;

    video.play();
    audio.play();

    playPauseBtn.textContent = "⏸";
    startProgressLoop();
}

// ======== SKIP CONTROLS ========
function skipBack() {
    audio.currentTime -= 10;
    video.currentTime = audio.currentTime;
}
function skipForward() {
    audio.currentTime += 10;
    video.currentTime = audio.currentTime;
}

// ======== PLAY / PAUSE ========
playPauseBtn.onclick = function () {
    if (audio.paused) {
        audio.play();
        video.play();
        playPauseBtn.textContent = "⏸";
    } else {
        audio.pause();
        video.pause();
        playPauseBtn.textContent = "▶";
    }
};

// ======== PROGRESS BAR LOOP ========
function startProgressLoop() {
    setInterval(() => {
        if (audio.duration) {
            let percent = (audio.currentTime / audio.duration) * 100;
            progress.style.width = percent + "%";
            video.currentTime = audio.currentTime;
        }
    }, 300);
}

function seek(event) {
    const rect = event.currentTarget.getBoundingClientRect();
    const percent = (event.clientX - rect.left) / rect.width;
    audio.currentTime = percent * audio.duration;
    video.currentTime = audio.currentTime;
}

// ======== VIDEO LIST ========
async function listVideos() {
    const { data } = await db.from("videos").select("*").order("created_at", { ascending: false });
    const list = document.getElementById("videoList");

    list.innerHTML = "";
    data.forEach(v => {
        const div = document.createElement("div");
        div.innerHTML = `
            <strong>${v.title}</strong><br>
            <button onclick="playVideo('${v.file_url}')">Play</button>
        `;
        list.appendChild(div);
    });
}
listVideos();

// ======== UPLOAD ========
async function uploadVideo() {
    const file = document.getElementById("fileInput").files[0];
    if (!file) return alert("No file selected");

    const ext = file.name.split(".").pop();
    const fileName = crypto.randomUUID() + "." + ext;

    const { error } = await db.storage.from("Storage").upload(fileName, file);
    if (error) return alert("Upload failed");

    const { data: pub } = db.storage.from("Storage").getPublicUrl(fileName);

    await db.from("videos").insert({
        title: file.name,
        file_path: fileName,
        file_url: pub.publicUrl,
        source_url: "",
        uploaded_by: null
    });

    alert("Upload OK!");
    listVideos();
}
</script>

</body>
</html>
